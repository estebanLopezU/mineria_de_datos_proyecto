<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Optimizador de PC</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>
</head>
<body>
    <div class="container">
        <h1>Dashboard de Rendimiento del Sistema</h1>
        <p>Monitoreo en tiempo real de los recursos del sistema</p>

        <div class="dashboard-grid">
            <!-- CPU Chart -->
            <div class="chart-card">
                <h3>CPU</h3>
                <div class="chart-container">
                    <canvas id="cpuChart"></canvas>
                </div>
                <div class="stats">
                    <span id="cpuPercent">0%</span>
                    <span id="cpuFreq">0 GHz</span>
                </div>
            </div>

            <!-- Memory Chart -->
            <div class="chart-card">
                <h3>Memoria RAM</h3>
                <div class="chart-container">
                    <canvas id="memoryChart"></canvas>
                </div>
                <div class="stats">
                    <span id="memoryUsed">0 GB</span> / <span id="memoryTotal">0 GB</span>
                </div>
            </div>

            <!-- Disk Chart -->
            <div class="chart-card">
                <h3>Disco Duro</h3>
                <div class="chart-container">
                    <canvas id="diskChart"></canvas>
                </div>
                <div class="stats">
                    <span id="diskUsed">0 GB</span> / <span id="diskTotal">0 GB</span>
                </div>
            </div>

            <!-- Network Chart -->
            <div class="chart-card">
                <h3>Red</h3>
                <div class="chart-container">
                    <canvas id="networkChart"></canvas>
                </div>
                <div class="stats">
                    <span id="netSent">0 MB</span> enviado<br>
                    <span id="netRecv">0 MB</span> recibido
                </div>
            </div>
        </div>

        <div class="system-info">
            <h3>Informaci√≥n del Sistema</h3>
            <div class="info-grid">
                <div class="info-item">
                    <strong>Procesos Activos:</strong> <span id="processCount">0</span>
                </div>
                <div class="info-item">
                    <strong>Tiempo de Actividad:</strong> <span id="uptime">0</span>
                </div>
                <div class="info-item">
                    <strong>Versi√≥n de Python:</strong> <span id="pythonVersion">-</span>
                </div>
                <div class="info-item">
                    <strong>Sistema Operativo:</strong> <span id="osVersion">-</span>
                </div>
            </div>
        </div>

        <!-- AI Assistant Section -->
        <div class="ai-assistant">
            <h3>ü§ñ Chat con OptiBot - Tu Asistente IA</h3>
            <div class="ai-chat-container">
                <div class="ai-chat-messages" id="aiChatMessages">
                    <div class="ai-message ai-bot welcome-message">
                        <div class="ai-avatar">ü§ñ</div>
                        <div class="ai-content">
                            <strong>OptiBot:</strong> ¬°Hola! Soy tu asistente inteligente de optimizaci√≥n. Estoy monitoreando tu PC en tiempo real.<br><br>
                            <strong>Estado actual:</strong><br>
                            ‚Ä¢ CPU: <span id="welcomeCpu">--</span>%<br>
                            ‚Ä¢ Memoria: <span id="welcomeMemory">--</span>%<br>
                            ‚Ä¢ Disco: <span id="welcomeDisk">--</span>%<br><br>
                            ¬øEn qu√© puedo ayudarte hoy? Puedes preguntarme sobre optimizaci√≥n, rendimiento, o cualquier tema. ¬°Solo escribe tu mensaje!
                        </div>
                    </div>
                </div>
                <div class="ai-chat-input-container">
                    <div class="ai-emoji-bar">
                        <button onclick="addEmoji('üòä')" title="Feliz">üòä</button>
                        <button onclick="addEmoji('üëç')" title="Me gusta">üëç</button>
                        <button onclick="addEmoji('‚ù§Ô∏è')" title="Coraz√≥n">‚ù§Ô∏è</button>
                        <button onclick="addEmoji('üòÇ')" title="Risa">üòÇ</button>
                        <button onclick="addEmoji('üòÆ')" title="Sorprendido">üòÆ</button>
                        <button onclick="addEmoji('üôè')" title="Gracias">üôè</button>
                        <button onclick="addEmoji('üîß')" title="Herramientas">üîß</button>
                        <button onclick="addEmoji('üíª')" title="Computadora">üíª</button>
                    </div>
                    <div class="ai-chat-input">
                        <input type="text" id="aiMessage" placeholder="Escribe tu mensaje aqu√≠..." />
                        <button onclick="sendMessage()" id="sendButton">
                            <span id="sendIcon">üì§</span>
                        </button>
                    </div>
                    <div class="ai-chat-status">
                        <span id="typingIndicator" style="display: none;">
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            <span class="typing-dot"></span>
                            OptiBot est√° escribiendo...
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-actions">
            <a href="/" class="btn-secondary">Volver al Optimizador</a>
            <button onclick="resetCharts()" class="btn-secondary">Reiniciar Gr√°ficos</button>
        </div>
    </div>

    <script>
        // Chart.js configurations
        let cpuChart, memoryChart, diskChart, networkChart;
        let cpuData = [], memoryData = [], diskData = [], networkData = [];
        const maxDataPoints = 20;

        // Initialize charts
        function initCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                animation: {
                    duration: 1000,
                    easing: 'easeInOutQuart'
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#ecf0f1'
                        }
                    },
                    x: {
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: '#ecf0f1'
                        }
                    }
                },
                plugins: {
                    legend: {
                        labels: {
                            color: '#ecf0f1'
                        }
                    }
                }
            };

            // CPU Chart
            cpuChart = new Chart(document.getElementById('cpuChart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'CPU %',
                        data: cpuData,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    ...chartOptions,
                    scales: {
                        ...chartOptions.scales,
                        y: {
                            ...chartOptions.scales.y,
                            max: 100
                        }
                    }
                }
            });

            // Memory Chart
            memoryChart = new Chart(document.getElementById('memoryChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Usado', 'Libre'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#e74c3c', '#27ae60'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ecf0f1'
                            }
                        }
                    }
                }
            });

            // Disk Chart
            diskChart = new Chart(document.getElementById('diskChart'), {
                type: 'doughnut',
                data: {
                    labels: ['Usado', 'Libre'],
                    datasets: [{
                        data: [0, 100],
                        backgroundColor: ['#f39c12', '#9b59b6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ecf0f1'
                            }
                        }
                    }
                }
            });

            // Network Chart
            networkChart = new Chart(document.getElementById('networkChart'), {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Enviado (MB)',
                        data: [],
                        borderColor: '#e67e22',
                        backgroundColor: 'rgba(230, 126, 34, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Recibido (MB)',
                        data: [],
                        borderColor: '#1abc9c',
                        backgroundColor: 'rgba(26, 188, 156, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: chartOptions
            });
        }

        // Update charts with new data
        function updateCharts(data) {
            const timestamp = new Date(data.timestamp * 1000).toLocaleTimeString();

            // CPU
            cpuData.push(data.cpu.percent);
            if (cpuData.length > maxDataPoints) cpuData.shift();
            cpuChart.data.labels = Array.from({length: cpuData.length}, (_, i) => i);
            cpuChart.data.datasets[0].data = cpuData;
            cpuChart.update();

            document.getElementById('cpuPercent').textContent = data.cpu.percent.toFixed(1) + '%';
            document.getElementById('cpuFreq').textContent = (data.cpu.freq_current / 1000).toFixed(2) + ' GHz';

            // Memory
            memoryChart.data.datasets[0].data = [data.memory.percent, 100 - data.memory.percent];
            memoryChart.update();

            document.getElementById('memoryUsed').textContent = data.memory.used + ' GB';
            document.getElementById('memoryTotal').textContent = data.memory.total + ' GB';

            // Disk
            diskChart.data.datasets[0].data = [data.disk.percent, 100 - data.disk.percent];
            diskChart.update();

            document.getElementById('diskUsed').textContent = data.disk.used + ' GB';
            document.getElementById('diskTotal').textContent = data.disk.total + ' GB';

            // Network
            if (networkData.length === 0) {
                networkData.push({sent: data.network.sent, recv: data.network.recv});
            } else {
                networkData.push({
                    sent: data.network.sent - networkData[networkData.length - 1].sent,
                    recv: data.network.recv - networkData[networkData.length - 1].recv
                });
            }
            if (networkData.length > maxDataPoints) networkData.shift();

            networkChart.data.labels = Array.from({length: networkData.length}, (_, i) => i);
            networkChart.data.datasets[0].data = networkData.map(d => d.sent);
            networkChart.data.datasets[1].data = networkData.map(d => d.recv);
            networkChart.update();

            document.getElementById('netSent').textContent = data.network.sent + ' MB';
            document.getElementById('netRecv').textContent = data.network.recv + ' MB';

            // System info
            document.getElementById('processCount').textContent = data.processes;
        }

        // Fetch system stats
        async function fetchSystemStats() {
            try {
                const response = await fetch('/api/system_stats');
                const data = await response.json();
                updateCharts(data);
            } catch (error) {
                console.error('Error fetching system stats:', error);
            }
        }

        // Reset charts
        function resetCharts() {
            cpuData.length = 0;
            memoryData.length = 0;
            diskData.length = 0;
            networkData.length = 0;

            cpuChart.data.labels = [];
            cpuChart.data.datasets[0].data = [];
            cpuChart.update();

            memoryChart.data.datasets[0].data = [0, 100];
            memoryChart.update();

            diskChart.data.datasets[0].data = [0, 100];
            diskChart.update();

            networkChart.data.labels = [];
            networkChart.data.datasets[0].data = [];
            networkChart.data.datasets[1].data = [];
            networkChart.update();
        }

        // AI Assistant Variables
        let currentStats = null;
        let aiMessageCount = 0;

        // AI Response function
        function generateAIResponse(question, stats) {
            const q = question.toLowerCase().trim();

            // An√°lisis inteligente basado en estad√≠sticas
            let response = '';

            // Palabras clave para componentes del sistema
            const cpuKeywords = ['cpu', 'procesador', 'procesador central', 'microprocesador', 'intel', 'amd', 'core'];
            const memoryKeywords = ['memoria', 'ram', 'memoria ram', 'memoria principal', 'ddr', 'gb ram'];
            const diskKeywords = ['disco', 'disco duro', 'almacenamiento', 'disco duro', 'ssd', 'hdd', 'disco s√≥lido'];
            const networkKeywords = ['red', 'internet', 'conexi√≥n', 'wifi', 'redes', 'ethernet', 'ip'];
            const processKeywords = ['procesos', 'programas', 'aplicaciones', 'tareas', 'servicios'];
            const optimizeKeywords = ['optimizar', 'mejorar', 'optimizar pc', 'mejorar rendimiento', 'acelerar', 'limpiar', 'limpieza'];

            // Palabras clave generales para conversaci√≥n
            const greetingKeywords = ['hola', 'hi', 'hello', 'buenos', 'buenas', 'saludos', 'hey'];
            const thanksKeywords = ['gracias', 'thank', 'merci', 'thanks'];
            const helpKeywords = ['ayuda', 'qu√© puedes', 'hacer', 'comandos', 'funciones'];
            const weatherKeywords = ['tiempo', 'clima', 'lluvia', 'sol', 'temperatura', 'weather'];
            const timeKeywords = ['hora', 'tiempo', 'fecha', 'qu√© hora', 'qu√© d√≠a'];
            const mathKeywords = ['cuanto es', 'calcula', 'suma', 'resta', 'multiplica', 'divide', 'calcular'];
            const generalKeywords = ['qu√© es', 'c√≥mo funciona', 'por qu√©', 'cu√°ndo', 'd√≥nde', 'qui√©n'];

            const hasKeyword = (keywords) => keywords.some(keyword => q.includes(keyword));

            // Sistema de conversaci√≥n general
            if (hasKeyword(greetingKeywords)) {
                const hour = new Date().getHours();
                let timeGreeting = 'buenos d√≠as';
                if (hour >= 12 && hour < 18) timeGreeting = 'buenas tardes';
                else if (hour >= 18) timeGreeting = 'buenas noches';

                response = `üëã ¬°${timeGreeting}! Soy **OptiBot**, tu asistente inteligente de optimizaci√≥n de PC.

Estoy monitoreando tu sistema en tiempo real:
‚Ä¢ CPU: ${stats.cpu.percent.toFixed(1)}%
‚Ä¢ Memoria: ${stats.memory.percent.toFixed(1)}%
‚Ä¢ Disco: ${stats.disk.percent.toFixed(1)}%
‚Ä¢ Procesos: ${stats.processes}

¬øEn qu√© puedo ayudarte hoy? Puedo responder preguntas sobre tu PC, optimizaci√≥n, o cualquier tema que te interese.`;
            } else if (hasKeyword(thanksKeywords)) {
                response = `üôÇ ¬°De nada! Estoy aqu√≠ para ayudarte. Si tienes m√°s preguntas sobre optimizaci√≥n de PC, rendimiento del sistema, o cualquier otro tema, ¬°no dudes en preguntarme!

¬øHay algo m√°s en lo que pueda asistirte?`;
            } else if (hasKeyword(helpKeywords)) {
                response = `ü§ñ **OPTI BOT - TU ASISTENTE INTELIGENTE**

**Sobre tu PC:**
‚Ä¢ An√°lisis completo del rendimiento del sistema
‚Ä¢ Recomendaciones de optimizaci√≥n personalizadas
‚Ä¢ Diagn√≥stico de problemas de rendimiento
‚Ä¢ Monitoreo en tiempo real de CPU, memoria, disco y red

**Conversaci√≥n General:**
‚Ä¢ Respuestas a preguntas sobre tecnolog√≠a, ciencia, matem√°ticas
‚Ä¢ Informaci√≥n general sobre diversos temas
‚Ä¢ C√°lculos matem√°ticos b√°sicos
‚Ä¢ Informaci√≥n del tiempo (general)
‚Ä¢ Conversaci√≥n natural sobre cualquier tema

**Ejemplos de preguntas:**
‚Ä¢ "¬øC√≥mo est√° mi CPU?" ‚Üí An√°lisis detallado
‚Ä¢ "¬øQu√© es una SSD?" ‚Üí Explicaci√≥n t√©cnica
‚Ä¢ "¬øCu√°nto es 15 + 27?" ‚Üí C√°lculo matem√°tico
‚Ä¢ "¬øPor qu√© mi PC est√° lenta?" ‚Üí Diagn√≥stico completo
‚Ä¢ "¬øQu√© es la inteligencia artificial?" ‚Üí Explicaci√≥n educativa

**Comandos disponibles:**
‚Ä¢ Preguntas sobre optimizaci√≥n del sistema
‚Ä¢ Consultas t√©cnicas y explicaciones
‚Ä¢ C√°lculos y operaciones matem√°ticas
‚Ä¢ Informaci√≥n general y educativa

¬°Solo escribe tu pregunta y te ayudar√©! üòä`;
            } else if (hasKeyword(weatherKeywords)) {
                response = `üå§Ô∏è **INFORMACI√ìN DEL TIEMPO**

Como soy un asistente local, no tengo acceso a datos meteorol√≥gicos en tiempo real, pero puedo darte consejos generales sobre el clima:

**Consejos para el mantenimiento de PC seg√∫n el clima:**
‚Ä¢ **Calor extremo:** Aseg√∫rate de buena ventilaci√≥n, limpia el polvo m√°s frecuentemente
‚Ä¢ **Humedad alta:** Previene la condensaci√≥n, usa deshumidificadores
‚Ä¢ **Fr√≠o:** Evita cambios bruscos de temperatura que puedan causar condensaci√≥n

**Para informaci√≥n del tiempo actual:**
‚Ä¢ Consulta apps meteorol√≥gicas como Weather App, AccuWeather
‚Ä¢ Revisa sitios web como meteored.com o eltiempo.es
‚Ä¢ Usa asistentes como Siri, Cortana o Google Assistant

¬øTe gustar√≠a que te ayude con alg√∫n aspecto espec√≠fico del cuidado de tu PC seg√∫n el clima?`;
            } else if (hasKeyword(timeKeywords)) {
                const now = new Date();
                const time = now.toLocaleTimeString('es-ES');
                const date = now.toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

                response = `üïê **INFORMACI√ìN DE TIEMPO Y FECHA**

‚Ä¢ **Hora actual:** ${time}
‚Ä¢ **Fecha:** ${date}
‚Ä¢ **Zona horaria:** ${Intl.DateTimeFormat().resolvedOptions().timeZone}

**Informaci√≥n adicional del sistema:**
‚Ä¢ Tu PC lleva funcionando aproximadamente ${Math.floor(performance.now() / 1000 / 60 / 60)} horas desde que abriste el navegador
‚Ä¢ Procesos activos: ${stats.processes}

¬øNecesitas ayuda con algo relacionado con el tiempo o el rendimiento de tu sistema?`;
            } else if (hasKeyword(mathKeywords)) {
                // Intentar resolver operaciones matem√°ticas simples
                try {
                    // Extraer n√∫meros y operaciones
                    const numbers = q.match(/\d+/g);
                    const operations = q.match(/[+\-*/]/g);

                    if (numbers && numbers.length >= 2) {
                        const num1 = parseFloat(numbers[0]);
                        const num2 = parseFloat(numbers[1]);

                        if (q.includes('suma') || q.includes('+')) {
                            response = `üßÆ **C√ÅLCULO MATEM√ÅTICO**
${num1} + ${num2} = **${num1 + num2}**

Si necesitas c√°lculos m√°s complejos, puedo ayudarte con sumas, restas, multiplicaciones y divisiones b√°sicas.`;
                        } else if (q.includes('resta') || q.includes('-')) {
                            response = `üßÆ **C√ÅLCULO MATEM√ÅTICO**
${num1} - ${num2} = **${num1 - num2}**

Si necesitas c√°lculos m√°s complejos, puedo ayudarte con sumas, restas, multiplicaciones y divisiones b√°sicas.`;
                        } else if (q.includes('multiplica') || q.includes('*')) {
                            response = `üßÆ **C√ÅLCULO MATEM√ÅTICO**
${num1} √ó ${num2} = **${num1 * num2}**

Si necesitas c√°lculos m√°s complejos, puedo ayudarte con sumas, restas, multiplicaciones y divisiones b√°sicas.`;
                        } else if (q.includes('divide') || q.includes('/')) {
                            if (num2 !== 0) {
                                response = `üßÆ **C√ÅLCULO MATEM√ÅTICO**
${num1} √∑ ${num2} = **${(num1 / num2).toFixed(2)}**

Si necesitas c√°lculos m√°s complejos, puedo ayudarte con sumas, restas, multiplicaciones y divisiones b√°sicas.`;
                            } else {
                                response = `üßÆ **ERROR MATEM√ÅTICO**
No se puede dividir por cero. ¬°El resultado ser√≠a infinito!

¬øTe gustar√≠a hacer otro c√°lculo matem√°tico?`;
                            }
                        } else {
                            response = `üßÆ **C√ÅLCULO MATEM√ÅTICO**
Detect√© los n√∫meros ${numbers.join(', ')} en tu pregunta.

Para realizar c√°lculos, puedes preguntarme:
‚Ä¢ "¬øCu√°nto es 15 + 27?"
‚Ä¢ "¬øPuedes calcular 100 - 25?"
‚Ä¢ "¬øCu√°nto es 8 √ó 7?"
‚Ä¢ "¬øDivide 144 entre 12?"

¬°Prueba con una operaci√≥n espec√≠fica!`;
                        }
                    } else {
                        response = `üßÆ **CALCULADORA INTEGRADA**

Puedo ayudarte con c√°lculos matem√°ticos b√°sicos. Solo preg√∫ntame:

**Ejemplos:**
‚Ä¢ "¬øCu√°nto es 15 + 27?"
‚Ä¢ "¬øPuedes calcular 100 - 25?"
‚Ä¢ "¬øCu√°nto es 8 √ó 7?"
‚Ä¢ "¬øDivide 144 entre 12?"

**Operaciones disponibles:**
‚Ä¢ Suma (+)
‚Ä¢ Resta (-)
‚Ä¢ Multiplicaci√≥n (√ó)
‚Ä¢ Divisi√≥n (√∑)

¬øTe gustar√≠a hacer alg√∫n c√°lculo?`;
                    }
                } catch (error) {
                    response = `üßÆ Lo siento, no pude procesar ese c√°lculo. Intenta preguntarme de forma m√°s simple, por ejemplo: "¬øCu√°nto es 15 + 27?"`;
                }
            } else if (hasKeyword(generalKeywords) || q.includes('qu√©') || q.includes('c√≥mo') || q.includes('por qu√©') || q.includes('cu√°ndo')) {
                // Respuestas a preguntas generales
                if (q.includes('qu√© es') && (q.includes('cpu') || q.includes('procesador'))) {
                    response = `üñ•Ô∏è **¬øQu√© es la CPU?**

La **CPU (Central Processing Unit)** es el "cerebro" de tu computadora. Es el componente principal que ejecuta todas las instrucciones de los programas.

**Caracter√≠sticas importantes:**
‚Ä¢ **N√∫cleos:** ${stats.cpu.count} n√∫cleos (permite multitasking)
‚Ä¢ **Frecuencia:** ${stats.cpu.freq_current.toFixed(0)} MHz (velocidad de procesamiento)
‚Ä¢ **Uso actual:** ${stats.cpu.percent.toFixed(1)}%

**Funci√≥n:** Procesa datos, ejecuta programas, coordina todas las operaciones del sistema.

¬øTe gustar√≠a saber m√°s sobre alg√∫n aspecto espec√≠fico de la CPU?`;
                } else if (q.includes('qu√© es') && q.includes('memoria ram')) {
                    response = `üíæ **¬øQu√© es la Memoria RAM?**

La **RAM (Random Access Memory)** es la memoria temporal de tu PC. Almacena datos que el sistema necesita acceder r√°pidamente.

**Tu sistema:**
‚Ä¢ **Total:** ${stats.memory.total.toFixed(1)} GB
‚Ä¢ **En uso:** ${stats.memory.used.toFixed(1)} GB (${stats.memory.percent.toFixed(1)}%)
‚Ä¢ **Disponible:** ${(stats.memory.total - stats.memory.used).toFixed(1)} GB

**Funci√≥n:** Almacena programas en ejecuci√≥n, datos temporales, mejora la velocidad de respuesta.

**Tip:** Si tu RAM est√° frecuentemente por encima del 80%, considera agregar m√°s memoria.`;
                } else if (q.includes('qu√© es') && (q.includes('disco') || q.includes('ssd') || q.includes('hdd'))) {
                    response = `üíø **¬øQu√© es un Disco Duro/SSD?**

El **disco duro** es el dispositivo de almacenamiento permanente de tu PC. Guarda todos tus archivos, programas y sistema operativo.

**Tu sistema:**
‚Ä¢ **Capacidad total:** ${stats.disk.total.toFixed(1)} GB
‚Ä¢ **En uso:** ${stats.disk.used.toFixed(1)} GB (${stats.disk.percent.toFixed(1)}%)
‚Ä¢ **Disponible:** ${(stats.disk.total - stats.disk.used).toFixed(1)} GB

**Tipos:**
‚Ä¢ **HDD:** Mec√°nico, m√°s lento pero m√°s barato
‚Ä¢ **SSD:** Electr√≥nico, mucho m√°s r√°pido y confiable

**Recomendaci√≥n:** Mant√©n al menos 20% de espacio libre para buen rendimiento.`;
                } else if (q.includes('qu√© es') && q.includes('inteligencia artificial')) {
                    response = `ü§ñ **¬øQu√© es la Inteligencia Artificial?**

La **Inteligencia Artificial (IA)** es la simulaci√≥n de procesos de inteligencia humana en m√°quinas programadas para pensar y aprender como los humanos.

**Yo soy un ejemplo de IA:**
‚Ä¢ Analizo datos en tiempo real
‚Ä¢ Aprendo de patrones del sistema
‚Ä¢ Doy recomendaciones inteligentes
‚Ä¢ Respondo preguntas conversacionalmente

**Aplicaciones de la IA:**
‚Ä¢ Asistentes virtuales (como yo)
‚Ä¢ Reconocimiento de im√°genes
‚Ä¢ Procesamiento de lenguaje natural
‚Ä¢ An√°lisis predictivo
‚Ä¢ Automatizaci√≥n inteligente

**Tipos de IA:**
‚Ä¢ **IA D√©bil/Estrecha:** Excelente en tareas espec√≠ficas (como yo para optimizaci√≥n)
‚Ä¢ **IA General:** Capaz de realizar cualquier tarea intelectual humana
‚Ä¢ **IA S√∫per Inteligente:** Hipot√©tica, m√°s inteligente que los humanos

¬øTe gustar√≠a saber m√°s sobre alg√∫n aspecto espec√≠fico de la IA?`;
                } else if (q.includes('c√≥mo funciona') && q.includes('computadora')) {
                    response = `üñ•Ô∏è **¬øC√≥mo funciona una computadora?**

Una computadora es un sistema complejo que procesa informaci√≥n a trav√©s de varios componentes que trabajan juntos:

**1. Hardware (Componentes f√≠sicos):**
‚Ä¢ **CPU:** Cerebro que procesa instrucciones
‚Ä¢ **RAM:** Memoria temporal para datos activos
‚Ä¢ **Disco Duro:** Almacenamiento permanente
‚Ä¢ **Tarjeta Gr√°fica:** Procesamiento visual
‚Ä¢ **Placa Madre:** Conecta todos los componentes

**2. Software (Programas):**
‚Ä¢ **Sistema Operativo:** Windows, macOS, Linux
‚Ä¢ **Aplicaciones:** Programas que usas diariamente
‚Ä¢ **Controladores:** Permiten comunicaci√≥n hardware-software

**3. Proceso b√°sico:**
1. Usuario da instrucciones (click, teclado)
2. Sistema operativo recibe la instrucci√≥n
3. CPU procesa los datos
4. RAM almacena datos temporales
5. Disco guarda informaci√≥n permanente
6. Pantalla muestra los resultados

**Tu PC actualmente:**
‚Ä¢ Procesando ${stats.processes} programas simult√°neamente
‚Ä¢ Usando ${stats.cpu.percent.toFixed(1)}% de capacidad de CPU
‚Ä¢ Gestionando ${stats.memory.used.toFixed(1)} GB de datos en RAM

¬øTe gustar√≠a que explique alg√∫n componente espec√≠fico?`;
                } else if (q.includes('por qu√©') && (q.includes('pc') || q.includes('computadora')) && q.includes('lenta')) {
                    response = `üêå **¬øPor qu√© mi PC est√° lenta?**

Bas√°ndome en el an√°lisis de tu sistema, aqu√≠ est√°n las posibles causas y soluciones:

**Estado actual de tu PC:**
‚Ä¢ CPU: ${stats.cpu.percent.toFixed(1)}% ${stats.cpu.percent > 80 ? 'üî¥ MUY ALTO' : stats.cpu.percent > 60 ? 'üü° ALTO' : 'üü¢ NORMAL'}
‚Ä¢ Memoria: ${stats.memory.percent.toFixed(1)}% ${stats.memory.percent > 85 ? 'üî¥ CR√çTICA' : stats.memory.percent > 70 ? 'üü° ALTA' : 'üü¢ BUENA'}
‚Ä¢ Disco: ${stats.disk.percent.toFixed(1)}% ${stats.disk.percent > 90 ? 'üî¥ CASI LLENO' : stats.disk.percent > 75 ? 'üü° LLENO' : 'üü¢ BUEN ESPACIO'}
‚Ä¢ Procesos: ${stats.processes} ${stats.processes > 150 ? 'üî¥ DEMASIADOS' : stats.processes > 100 ? 'üü° MODERADOS' : 'üü¢ √ìPTIMO'}

**Causas m√°s comunes de lentitud:**

1. **Recursos insuficientes:**
   ‚Ä¢ CPU sobrecargada por m√∫ltiples programas
   ‚Ä¢ Memoria RAM llena
   ‚Ä¢ Disco duro casi sin espacio

2. **Problemas de software:**
   ‚Ä¢ Muchos programas inici√°ndose con Windows
   ‚Ä¢ Malware o virus
   ‚Ä¢ Controladores desactualizados
   ‚Ä¢ Registro de Windows fragmentado

3. **Problemas de hardware:**
   ‚Ä¢ Disco duro da√±ado o fragmentado
   ‚Ä¢ Ventiladores sucios (sobrecalentamiento)
   ‚Ä¢ Memoria RAM defectuosa

4. **Problemas de configuraci√≥n:**
   ‚Ä¢ Animaciones y efectos visuales activados
   ‚Ä¢ Servicios innecesarios ejecut√°ndose
   ‚Ä¢ Configuraci√≥n de energ√≠a inadecuada

**Soluciones inmediatas:**
1. Cierra programas que no uses
2. Ejecuta optimizaciones completas
3. Limpia archivos temporales
4. Reinicia el sistema

¬øTe gustar√≠a que ejecute alguna optimizaci√≥n espec√≠fica para mejorar el rendimiento?`;
                } else {
                    // Respuesta general para preguntas que no entiende espec√≠ficamente
                    response = `ü§î **Pregunta interesante: "${question}"**

Como asistente inteligente, puedo ayudarte con informaci√≥n sobre:

**üíª Tu PC y optimizaci√≥n:**
‚Ä¢ An√°lisis de rendimiento del sistema
‚Ä¢ Recomendaciones de optimizaci√≥n
‚Ä¢ Diagn√≥stico de problemas
‚Ä¢ Consejos de mantenimiento

**üßÆ C√°lculos matem√°ticos:**
‚Ä¢ Sumas, restas, multiplicaciones, divisiones
‚Ä¢ C√°lculos b√°sicos

**üìö Conocimiento general:**
‚Ä¢ Tecnolog√≠a y computaci√≥n
‚Ä¢ Ciencia y explicaciones
‚Ä¢ Consejos pr√°cticos

**üåê Informaci√≥n general:**
‚Ä¢ Tiempo (consejos)
‚Ä¢ Fechas y horas
‚Ä¢ Conversaci√≥n natural

**Para responder mejor tu pregunta, podr√≠as:**
‚Ä¢ Darme m√°s detalles espec√≠ficos
‚Ä¢ Preguntarme sobre aspectos relacionados con tu PC
‚Ä¢ Hacer una pregunta m√°s concreta

¬øTe gustar√≠a reformular tu pregunta o prefieres que te ayude con algo relacionado con la optimizaci√≥n de tu PC?

**Estado actual de tu sistema:**
‚Ä¢ CPU: ${stats.cpu.percent.toFixed(1)}%
‚Ä¢ Memoria: ${stats.memory.percent.toFixed(1)}%
‚Ä¢ Disco: ${stats.disk.percent.toFixed(1)}%`;
                }
            } else if (hasKeyword(cpuKeywords)) {
                const usage = stats.cpu.percent;
                if (usage > 90) {
                    response = `üö® ¬°ALERTA CR√çTICA! Tu CPU est√° al ${usage.toFixed(1)}%, lo cual es extremadamente alto. Esto puede causar inestabilidad. Te recomiendo:\n‚Ä¢ Cerrar inmediatamente programas innecesarios\n‚Ä¢ Ejecutar optimizaci√≥n de procesos\n‚Ä¢ Revisar si hay malware\n‚Ä¢ Considerar reiniciar el sistema`;
                } else if (usage > 80) {
                    response = `‚ö†Ô∏è Tu CPU est√° muy alta al ${usage.toFixed(1)}%. Te recomiendo:\n‚Ä¢ Cerrar programas que no uses\n‚Ä¢ Ejecutar limpieza de archivos temporales\n‚Ä¢ Desactivar programas de inicio innecesarios`;
                } else if (usage > 60) {
                    response = `üìä Tu CPU est√° al ${usage.toFixed(1)}%, funcionando con carga moderada. Si notas lentitud:\n‚Ä¢ Limpia archivos temporales\n‚Ä¢ Verifica procesos en el administrador de tareas\n‚Ä¢ Considera actualizar controladores`;
                } else if (usage > 30) {
                    response = `‚úÖ Tu CPU est√° funcionando bien al ${usage.toFixed(1)}%. Rendimiento normal.`;
                } else {
                    response = `üåü ¬°Excelente! Tu CPU est√° pr√°cticamente inactiva al ${usage.toFixed(1)}%. Rendimiento √≥ptimo.`;
                }
            } else if (hasKeyword(memoryKeywords)) {
                const usage = stats.memory.percent;
                if (usage > 95) {
                    response = `üö® ¬°MEMORIA CR√çTICA! ${usage.toFixed(1)}% de uso. Riesgo de bloqueo inminente:\n‚Ä¢ Cierra TODOS los programas innecesarios\n‚Ä¢ Reinicia el navegador web\n‚Ä¢ Ejecuta limpieza de memoria inmediatamente\n‚Ä¢ Considera agregar m√°s RAM`;
                } else if (usage > 85) {
                    response = `‚ö†Ô∏è Memoria RAM casi llena (${usage.toFixed(1)}%). Acciones urgentes:\n‚Ä¢ Cierra aplicaciones que no uses\n‚Ä¢ Limpia cache del navegador\n‚Ä¢ Verifica procesos con alto consumo de memoria`;
                } else if (usage > 70) {
                    response = `üìä Memoria RAM con carga alta (${usage.toFixed(1)}%). Recomendaciones:\n‚Ä¢ Monitorea procesos en administrador de tareas\n‚Ä¢ Limpia archivos temporales\n‚Ä¢ Considera cerrar pesta√±as del navegador`;
                } else if (usage > 50) {
                    response = `‚úÖ Memoria RAM en buen estado (${usage.toFixed(1)}% de uso).`;
                } else {
                    response = `üåü ¬°Excelente uso de memoria! Solo ${usage.toFixed(1)}% utilizado.`;
                }
            } else if (hasKeyword(diskKeywords)) {
                const usage = stats.disk.percent;
                const freeGB = ((100 - usage) / 100 * stats.disk.total).toFixed(1);
                if (usage > 95) {
                    response = `üö® ¬°DISCO CR√çTICO! ${usage.toFixed(1)}% lleno. Solo quedan ${freeGB} GB libres:\n‚Ä¢ BORRA ARCHIVOS INNECESARIOS INMEDIATAMENTE\n‚Ä¢ Vac√≠a papelera de reciclaje\n‚Ä¢ Ejecuta limpieza de disco profunda\n‚Ä¢ Mueve archivos a disco externo`;
                } else if (usage > 90) {
                    response = `‚ö†Ô∏è Disco casi lleno (${usage.toFixed(1)}%, ${freeGB} GB libres). Acciones necesarias:\n‚Ä¢ Limpia archivos temporales\n‚Ä¢ Vac√≠a papelera de reciclaje\n‚Ä¢ Elimina programas no utilizados\n‚Ä¢ Mueve archivos grandes`;
                } else if (usage > 80) {
                    response = `üìä Disco con mucho uso (${usage.toFixed(1)}%, ${freeGB} GB libres). Recomendaciones:\n‚Ä¢ Ejecuta optimizaciones de limpieza\n‚Ä¢ Organiza archivos\n‚Ä¢ Considera desfragmentaci√≥n`;
                } else if (usage > 60) {
                    response = `‚úÖ Disco en buen estado (${usage.toFixed(1)}% usado, ${freeGB} GB libres).`;
                } else {
                    response = `üåü ¬°Excelente! Mucho espacio disponible (${(100 - usage).toFixed(1)}% libre, ${freeGB} GB).`;
                }
            } else if (hasKeyword(networkKeywords)) {
                const sent = stats.network.sent;
                const recv = stats.network.recv;
                response = `üì° Informaci√≥n de red:\n‚Ä¢ Datos enviados: ${sent} MB\n‚Ä¢ Datos recibidos: ${recv} MB\n‚Ä¢ Total transferido: ${(sent + recv).toFixed(1)} MB\n\nSi tienes problemas de conexi√≥n:\n‚Ä¢ Reinicia el router/m√≥dem\n‚Ä¢ Verifica configuraci√≥n de red\n‚Ä¢ Ejecuta diagn√≥stico de red\n‚Ä¢ Actualiza controladores de red`;
            } else if (hasKeyword(processKeywords)) {
                const count = stats.processes;
                if (count > 200) {
                    response = `üö® ¬°DEMASIADOS PROCESOS! ${count} procesos activos. Esto puede ralentizar tu PC:\n‚Ä¢ Cierra programas innecesarios\n‚Ä¢ Desactiva programas de inicio\n‚Ä¢ Revisa procesos en administrador de tareas\n‚Ä¢ Busca y elimina malware`;
                } else if (count > 150) {
                    response = `‚ö†Ô∏è Muchos procesos (${count}). Recomendaciones:\n‚Ä¢ Revisa administrador de tareas\n‚Ä¢ Desactiva programas de inicio innecesarios\n‚Ä¢ Limpia registro de Windows`;
                } else if (count > 100) {
                    response = `üìä N√∫mero moderado de procesos (${count}). Monitorea el rendimiento.`;
                } else {
                    response = `‚úÖ N√∫mero √≥ptimo de procesos (${count}). Excelente gesti√≥n del sistema.`;
                }
            } else if (hasKeyword(optimizeKeywords)) {
                const cpu = stats.cpu.percent;
                const mem = stats.memory.percent;
                const disk = stats.disk.percent;
                response = `üöÄ **PLAN DE OPTIMIZACI√ìN PERSONALIZADO**\n\nEstado actual:\n‚Ä¢ CPU: ${cpu.toFixed(1)}%\n‚Ä¢ Memoria: ${mem.toFixed(1)}%\n‚Ä¢ Disco: ${disk.toFixed(1)}%\n\n**Acciones recomendadas:**\n\n1. **Limpieza B√°sica**\n   ‚Ä¢ Archivos temporales\n   ‚Ä¢ Papelera de reciclaje\n   ‚Ä¢ Prefetch y archivos temporales\n\n2. **Optimizaciones Avanzadas**\n   ‚Ä¢ Desfragmentaci√≥n de disco\n   ‚Ä¢ Limpieza de cache de navegadores\n   ‚Ä¢ Actualizaci√≥n de Windows\n\n3. **Mantenimiento**\n   ‚Ä¢ Desactivar programas de inicio\n   ‚Ä¢ Actualizar controladores\n   ‚Ä¢ Escaneo de malware\n\n¬øQuieres que ejecute alguna optimizaci√≥n espec√≠fica?`;
            } else if (q.includes('ayuda') || q.includes('qu√© puedes') || q.includes('hacer') || q.includes('comandos')) {
                response = `ü§ñ **OPTI BOT - TU ASISTENTE DE OPTIMIZACI√ìN**\n\nPuedo ayudarte con:\n\nüìä **An√°lisis en Tiempo Real**\n‚Ä¢ CPU, Memoria, Disco, Red\n‚Ä¢ Procesos activos\n‚Ä¢ Rendimiento general\n\nüí° **Recomendaciones Inteligentes**\n‚Ä¢ Diagn√≥stico autom√°tico de problemas\n‚Ä¢ Planes de optimizaci√≥n personalizados\n‚Ä¢ Consejos preventivos\n\n‚ùì **Preguntas que puedo responder**\n‚Ä¢ "¬øC√≥mo est√° mi CPU?"\n‚Ä¢ "¬øQu√© optimizaciones recomiendas?"\n‚Ä¢ "¬øPor qu√© mi PC est√° lenta?"\n‚Ä¢ "¬øCu√°nta memoria estoy usando?"\n‚Ä¢ "¬øNecesito m√°s espacio?"\n\nüîß **Ejemplos de comandos**\n‚Ä¢ Preg√∫ntame sobre cualquier componente\n‚Ä¢ Pide recomendaciones espec√≠ficas\n‚Ä¢ Preg√∫ntame sobre el rendimiento\n\n¬°Solo escribe tu pregunta y te ayudar√©!`;
            } else if (q.includes('gracias') || q.includes('thank') || q.includes('merci')) {
                response = `üôÇ ¬°De nada! Estoy aqu√≠ 24/7 para mantener tu PC funcionando perfectamente. Si notas cualquier problema o tienes preguntas sobre optimizaci√≥n, ¬°no dudes en preguntarme!\n\n¬øHay algo m√°s en lo que pueda ayudarte?`;
            } else if (q.includes('hola') || q.includes('hi') || q.includes('hello') || q.includes('buenos') || q.includes('buenas')) {
                response = `üëã ¬°Hola! Soy **OptiBot**, tu asistente inteligente de optimizaci√≥n de PC.\n\nEstoy monitoreando constantemente tu sistema:\n‚Ä¢ CPU: ${stats.cpu.percent.toFixed(1)}%\n‚Ä¢ Memoria: ${stats.memory.percent.toFixed(1)}%\n‚Ä¢ Disco: ${stats.disk.percent.toFixed(1)}%\n‚Ä¢ Procesos: ${stats.processes}\n\n¬øEn qu√© puedo ayudarte hoy? Preg√∫ntame sobre el rendimiento de tu PC o pide recomendaciones de optimizaci√≥n.`;
            } else if (q.includes('problema') || q.includes('lenta') || q.includes('lento') || q.includes('error')) {
                response = `üîç **DIAGN√ìSTICO DE PROBLEMAS**\n\nEstado actual de tu PC:\n‚Ä¢ CPU: ${stats.cpu.percent.toFixed(1)}% ${stats.cpu.percent > 80 ? 'üî¥ ALTO' : stats.cpu.percent > 60 ? 'üü° MODERADO' : 'üü¢ BUENO'}\n‚Ä¢ Memoria: ${stats.memory.percent.toFixed(1)}% ${stats.memory.percent > 85 ? 'üî¥ CR√çTICO' : stats.memory.percent > 70 ? 'üü° ALTO' : 'üü¢ BUENO'}\n‚Ä¢ Disco: ${stats.disk.percent.toFixed(1)}% ${stats.disk.percent > 90 ? 'üî¥ LLENO' : stats.disk.percent > 75 ? 'üü° CASI LLENO' : 'üü¢ BUENO'}\n‚Ä¢ Procesos: ${stats.processes} ${stats.processes > 150 ? 'üî¥ DEMASIADOS' : stats.processes > 100 ? 'üü° MODERADOS' : 'üü¢ √ìPTIMO'}\n\n**Posibles causas de lentitud:**\n‚Ä¢ Alto uso de CPU por programas pesados\n‚Ä¢ Memoria insuficiente para multitasking\n‚Ä¢ Disco duro fragmentado o casi lleno\n‚Ä¢ Muchos procesos ejecut√°ndose\n‚Ä¢ Malware o virus\n‚Ä¢ Controladores desactualizados\n\n**Soluciones recomendadas:**\n1. Ejecuta optimizaciones completas\n2. Cierra programas innecesarios\n3. Limpia disco y memoria\n4. Actualiza software y controladores\n5. Escanea por malware\n\n¬øQuieres que ejecute alguna optimizaci√≥n espec√≠fica?`;
            } else if (q.includes('velocidad') || q.includes('rendimiento') || q.includes('performance')) {
                response = `‚ö° **AN√ÅLISIS DE RENDIMIENTO**\n\nTu PC est√° funcionando:\n\n**CPU:** ${stats.cpu.percent.toFixed(1)}% de uso\n‚Ä¢ Frecuencia: ${stats.cpu.freq_current.toFixed(0)} MHz\n‚Ä¢ ${stats.cpu.percent < 50 ? 'Excelente rendimiento' : stats.cpu.percent < 80 ? 'Buen rendimiento' : 'Rendimiento limitado'}\n\n**Memoria:** ${stats.memory.percent.toFixed(1)}% utilizada\n‚Ä¢ ${stats.memory.used.toFixed(1)} GB de ${stats.memory.total.toFixed(1)} GB\n‚Ä¢ ${stats.memory.percent < 70 ? 'Buena capacidad de memoria' : 'Memoria limitada'}\n\n**Disco:** ${stats.disk.percent.toFixed(1)}% utilizado\n‚Ä¢ ${stats.disk.used.toFixed(1)} GB de ${stats.disk.total.toFixed(1)} GB libres\n‚Ä¢ Velocidad: ${stats.disk.percent < 80 ? 'Buena velocidad de acceso' : 'Acceso limitado por espacio'}\n\n**Recomendaciones para mejorar velocidad:**\n‚Ä¢ Mant√©n CPU por debajo del 70%\n‚Ä¢ Libera al menos 30% de memoria\n‚Ä¢ Mant√©n disco por debajo del 80%\n‚Ä¢ Ejecuta mantenimiento semanal\n‚Ä¢ Actualiza hardware si es necesario\n\n¬øTe gustar√≠a ver recomendaciones espec√≠ficas?`;
            } else {
                // Respuesta gen√©rica pero √∫til
                response = `ü§î **${question}**\n\nNo entend√≠ completamente tu pregunta, pero puedo analizar tu sistema:\n\nüìä **Estado Actual:**\n‚Ä¢ CPU: ${stats.cpu.percent.toFixed(1)}%\n‚Ä¢ Memoria: ${stats.memory.percent.toFixed(1)}%\n‚Ä¢ Disco: ${stats.disk.percent.toFixed(1)}%\n‚Ä¢ Procesos: ${stats.processes}\n\nüí° **Puedo ayudarte con:**\n‚Ä¢ An√°lisis detallado de cualquier componente\n‚Ä¢ Recomendaciones de optimizaci√≥n\n‚Ä¢ Diagn√≥stico de problemas de rendimiento\n‚Ä¢ Consejos para mejorar velocidad\n\n**Prueba preguntando:**\n‚Ä¢ "¬øC√≥mo est√° mi CPU?"\n‚Ä¢ "¬øQu√© optimizaciones recomiendas?"\n‚Ä¢ "¬øPor qu√© mi PC est√° lenta?"\n‚Ä¢ "¬øC√≥mo mejorar el rendimiento?"\n\n¬°Solo dime qu√© necesitas saber!`;
            }

            return response;
        }

        // Add message to chat
        function addMessage(message, isUser = false) {
            const chatContainer = document.getElementById('aiChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `ai-message ${isUser ? 'ai-user' : 'ai-bot'}`;

            const timestamp = new Date().toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });

            messageDiv.innerHTML = `
                <div class="ai-avatar">${isUser ? 'üë§' : 'ü§ñ'}</div>
                <div class="ai-content">
                    <div class="ai-message-header">
                        <strong>${isUser ? 'T√∫' : 'OptiBot'}</strong>
                        <span class="ai-timestamp">${timestamp}</span>
                    </div>
                    <div class="ai-message-text">${message.replace(/\n/g, '<br>')}</div>
                </div>
            `;

            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            aiMessageCount++;

            // Limit messages to prevent overflow (keep last 15 messages)
            if (aiMessageCount > 15) {
                const firstMessage = chatContainer.querySelector('.ai-message');
                if (firstMessage && !firstMessage.classList.contains('welcome-message')) {
                    chatContainer.removeChild(firstMessage);
                    aiMessageCount--;
                }
            }
        }

        // Show typing indicator
        function showTyping() {
            const statusDiv = document.getElementById('typingIndicator');
            statusDiv.style.display = 'block';
        }

        // Hide typing indicator
        function hideTyping() {
            const statusDiv = document.getElementById('typingIndicator');
            statusDiv.style.display = 'none';
        }

        // Send message function
        function sendMessage() {
            const input = document.getElementById('aiMessage');
            const message = input.value.trim();

            if (!message) return;

            // Disable input while processing
            input.disabled = true;
            document.getElementById('sendButton').disabled = true;
            document.getElementById('sendIcon').textContent = '‚è≥';

            // Add user message
            addMessage(message, true);

            // Show typing indicator
            showTyping();

            // Clear input
            input.value = '';

            // Generate AI response with delay
            setTimeout(() => {
                const response = generateAIResponse(message, currentStats);

                // Hide typing and show response
                hideTyping();
                addMessage(response);

                // Re-enable input
                input.disabled = false;
                document.getElementById('sendButton').disabled = false;
                document.getElementById('sendIcon').textContent = 'üì§';

                // Focus input
                input.focus();
            }, 1000 + Math.random() * 1000); // Random delay between 1-2 seconds for natural feel
        }

        // Allow Enter key to send message
        document.getElementById('aiMessage').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Update welcome message with current stats
        function updateWelcomeMessage(stats) {
            const welcomeCpu = document.getElementById('welcomeCpu');
            const welcomeMemory = document.getElementById('welcomeMemory');
            const welcomeDisk = document.getElementById('welcomeDisk');

            if (welcomeCpu && stats) {
                welcomeCpu.textContent = stats.cpu.percent.toFixed(1) + '%';
                welcomeMemory.textContent = stats.memory.percent.toFixed(1) + '%';
                welcomeDisk.textContent = stats.disk.percent.toFixed(1) + '%';
            }
        }

        // Add emoji to input
        function addEmoji(emoji) {
            const input = document.getElementById('aiMessage');
            input.value += emoji;
            input.focus();
        }

        // Drag functionality
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let initialX = 0;
        let initialY = 0;

        function initDrag() {
            const aiAssistant = document.querySelector('.ai-assistant');

            aiAssistant.addEventListener('mousedown', startDrag);
            aiAssistant.addEventListener('touchstart', startDrag, { passive: false });

            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: false });

            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);
        }

        function startDrag(e) {
            const aiAssistant = document.querySelector('.ai-assistant');

            // Only start drag if clicking on the drag handle or the header area
            if (e.target.closest('.drag-handle') || e.target.tagName === 'H3') {
                isDragging = true;
                aiAssistant.classList.add('dragging');

                const rect = aiAssistant.getBoundingClientRect();
                initialX = rect.left;
                initialY = rect.top;

                if (e.type === 'touchstart') {
                    dragStartX = e.touches[0].clientX;
                    dragStartY = e.touches[0].clientY;
                } else {
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                }

                e.preventDefault();
            }
        }

        function drag(e) {
            if (!isDragging) return;

            e.preventDefault();

            let currentX, currentY;
            if (e.type === 'touchmove') {
                currentX = e.touches[0].clientX;
                currentY = e.touches[0].clientY;
            } else {
                currentX = e.clientX;
                currentY = e.clientY;
            }

            const deltaX = currentX - dragStartX;
            const deltaY = currentY - dragStartY;

            const aiAssistant = document.querySelector('.ai-assistant');
            const newX = initialX + deltaX;
            const newY = initialY + deltaY;

            // Keep within viewport bounds
            const maxX = window.innerWidth - aiAssistant.offsetWidth;
            const maxY = window.innerHeight - aiAssistant.offsetHeight;

            aiAssistant.style.left = Math.max(0, Math.min(newX, maxX)) + 'px';
            aiAssistant.style.top = Math.max(0, Math.min(newY, maxY)) + 'px';
            aiAssistant.style.position = 'fixed';
        }

        function endDrag() {
            if (isDragging) {
                isDragging = false;
                const aiAssistant = document.querySelector('.ai-assistant');
                aiAssistant.classList.remove('dragging');
            }
        }

        // Update charts with new data
        function updateCharts(data) {
            currentStats = data; // Store for AI use
            const timestamp = new Date(data.timestamp * 1000).toLocaleTimeString();

            // CPU
            cpuData.push(data.cpu.percent);
            if (cpuData.length > maxDataPoints) cpuData.shift();
            cpuChart.data.labels = Array.from({length: cpuData.length}, (_, i) => i);
            cpuChart.data.datasets[0].data = cpuData;
            cpuChart.update();

            document.getElementById('cpuPercent').textContent = data.cpu.percent.toFixed(1) + '%';
            document.getElementById('cpuFreq').textContent = (data.cpu.freq_current / 1000).toFixed(2) + ' GHz';

            // Memory
            memoryChart.data.datasets[0].data = [data.memory.percent, 100 - data.memory.percent];
            memoryChart.update();

            document.getElementById('memoryUsed').textContent = data.memory.used + ' GB';
            document.getElementById('memoryTotal').textContent = data.memory.total + ' GB';

            // Disk
            diskChart.data.datasets[0].data = [data.disk.percent, 100 - data.disk.percent];
            diskChart.update();

            document.getElementById('diskUsed').textContent = data.disk.used + ' GB';
            document.getElementById('diskTotal').textContent = data.disk.total + ' GB';

            // Network
            if (networkData.length === 0) {
                networkData.push({sent: data.network.sent, recv: data.network.recv});
            } else {
                networkData.push({
                    sent: data.network.sent - networkData[networkData.length - 1].sent,
                    recv: data.network.recv - networkData[networkData.length - 1].recv
                });
            }
            if (networkData.length > maxDataPoints) networkData.shift();

            networkChart.data.labels = Array.from({length: networkData.length}, (_, i) => i);
            networkChart.data.datasets[0].data = networkData.map(d => d.sent);
            networkChart.data.datasets[1].data = networkData.map(d => d.recv);
            networkChart.update();

            document.getElementById('netSent').textContent = data.network.sent + ' MB';
            document.getElementById('netRecv').textContent = data.network.recv + ' MB';

            // System info
            document.getElementById('processCount').textContent = data.processes;

            // Update welcome message stats
            updateWelcomeMessage(data);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initCharts();
            initDrag(); // Initialize drag functionality

            // Get system info once
            fetch('/api/system_stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('pythonVersion').textContent = '3.x';
                    document.getElementById('osVersion').textContent = navigator.platform;

                    // Calculate uptime (simplified)
                    const uptime = Math.floor(performance.now() / 1000 / 60 / 60);
                    document.getElementById('uptime').textContent = uptime + ' horas';
                });

            // Update every 2 seconds
            setInterval(fetchSystemStats, 2000);
        });
    </script>
</body>
</html>        });
